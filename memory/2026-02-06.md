# 2026-02-06 - 工作日志

## 09:00 - 定时任务问题修复

**问题:** 每日9点系统报告和每日AI新闻简报没有按时发送

**原因:** Cron任务的 `anchorMs` 配置错误，设置为未来的日期（2026-02-08），导致前两天都没有触发

**解决方案:**
- 修正 `daily-system-report-9am` 任务的 `anchorMs` 为 1770259200000 (2026-02-04)
- 修正 `每日AI新闻简报` 任务的执行时间从9点改为10点，`anchorMs` 为 1770256800000 (2026-02-05 10:00)
- 从明天（2月7日）起，两个任务将正常运行

## 09:21 - AI新闻简报手动发送

**操作:** 由于定时任务配置问题，手动执行了第一次AI新闻简报发送

**内容亮点:**
- Claude Opus 4.6 发布 (1568 points)
- GPT-5.3-Codex 发布 (1039 points)
- AI Agent协作成为热点趋势

## 11:23 - 服务重启

**观察:** Maymay backend和Heroweb backend都在11:23左右重启
- Maymay backend PID从 117566 变为 755
- Heroweb backend PID从 129975 变为 753
- 可能是系统更新或手动重启
- 当前运行正常，内存使用率从53%降至26%

## 12:21 - Azure账号配置记录

**操作:** 记录Azure Storage connection string到TOOLS.md

**详情:**
- Account Name: maymaynail
- 用途: Maymay穿戴甲平台的Azure Blob存储（图片、文件上传等）
- Connection string已保存至 TOOLS.md

**备注:** 敏感信息需要妥善保管，不要泄露

## 12:32 - Azure配置文档重要性确认 🔴

**指示:** 用户强调 azure.md 文件非常重要

**执行的操作:**
1. 更新 `AGENTS.md` - 将 azure.md 添加到"Every Session"必读清单
2. 更新 `MEMORY.md` - 在 Critical Tasks 中添加 Always Read azure.md First
3. 更新 `TOOLS.md` - 改为引用 azure.md 而不是重复记录

**重要规则:**
- 每次重启、开始新对话，必须先读 azure.md
- 包含 Azure Storage connection strings
- 包含所有核心表格结构（7个表）
- 包含表操作规则：严格遵守用户给出的规则

**原因:** 避免操作 Azure Storage 时出错，确保数据结构一致

## 12:34 - 工作区整理规范

**要求:** 临时文件统一管理，保持工作区整洁

**执行的操作:**
1. 检查 temp 目录 - ✅ 已存在 (创建于 12:31)
2. 更新 .gitignore - ✅ 添加 temp/ 到忽略列表
3. 更新 AGENTS.md - ✅ 添加 Workspace Organization 规范

**新规则:**
- 所有临时文件必须放在 `temp/` 目录
  - 任务生成的代码
  - 下载的文件
  - 临时脚本和数据
- 保持工作区根目录整洁
- temp/ 已加入 .gitignore，不会被 git 跟踪

**好处:**
- 工作区结构清晰
- 避免临时文件污染版本控制
- 便于清理和管理

## 12:40 - 完善Azure文档 📚

**任务:** 读取 maymay-backend 代码，完善 azure.md 文档

**执行的操作:**
1. 读取了所有模型定义文件（product, user, order, payment, common_style）
2. 读取了所有服务层代码（product_service, auth_service, order_service, payment_service, favorites_service, common_style_service, blacklist_ip_service）
3. 分析了每个表的：
   - PartitionKey 和 RowKey 设计
   - 所有字段列表和类型
   - 字段说明和约束
   - JSON 字段的处理方式
   - 业务逻辑和状态流程
4. 完全重写了 azure.md，从简单列表变为详细的技术文档

**新文档包含:**
- Connection string
- 7个表的完整结构（maymayproducts, maymayusers, maymayorders, maymaypayments, maymayFavorites, maymayCommonStyles, BlackListIP）
- 每个表的字段定义、类型、必填项、说明
- PartitionKey/RowKey 设计模式
- JSON 字段的序列化/反序列化说明
- 业务流程（订单状态、支付状态）
- 服务层代码位置
- 模型定义位置
- 缓存策略

**文档大小:** 从 ~500字 增加到 ~8000字

**价值:**
- 完整的技术参考，避免操作 Azure Storage 时出错
- 新开发者可以快速了解数据结构
- 包含代码位置，便于查找实现

## 12:44 - 商品统计

**任务:** 查询 Maymay 平台商品总数

**执行的操作:**
1. 创建临时查询脚本 `temp/count_products.py`
2. 使用 Azure Table Storage SDK 查询 maymayproducts 表
3. 统计商品总数和各状态数量

**结果:**
- 总商品数: 91件
- Active (在售): 28件
- Inactive (下架): 0件
- Tracking (监控中): 0件

**发现:**
- 剩余63件商品可能使用旧的状态字段（is_active）
- 建议检查是否需要状态迁移

## 12:48 - 推送到GitHub 🔐

**任务:** 推送工作区更新到GitHub

**执行的操作:**
1. Git add 所有更改
2. Git commit（详细提交信息）
3. 首次推送失败 - GitHub检测到敏感信息（Azure Storage Account Key）
4. 修改azure.md，移除真实connection string，使用占位符
5. Git commit --amend 修改提交
6. 强制推送成功

**提交内容 (1b2d1ac):**
- 新增文档: azure.md (8000字完整技术文档), IMAGE_GEN_CONFIG.md, memory/2026-02-06.md
- 重要更新: AGENTS.md (添加azure.md必读), MEMORY.md, TOOLS.md
- 工作区规范: .gitignore (temp/), AGENTS.md (Workspace Organization)
- 新增技能: baoyu-skills, notebooklm-skill, tts-whatsapp, expense-tracker-pro, outlook, advanced-skill-creator
- 清理: 删除过时的川菜餐厅搜索脚本

**安全教训:**
- ❌ 不要将真实的connection string写入文档并提交到Git
- ✅ 使用占位符 `<ACCOUNT_NAME>`, `<ACCOUNT_KEY>`
- ✅ GitHub Secret Scanning会自动检测并阻止敏感信息推送
- ✅ 本地可以保存真实的connection string（在.gitignore之外）

**统计:**
- 50个文件更改
- 7851行新增
- 67行删除

## 12:52 - 安全改进：分离敏感信息 🔐

**任务:** 将 connection string 从文档中分离，存放到专门的 credentials 目录

**执行的操作:**
1. 创建 `credentials/` 目录
2. 将 Azure connection string 存入 `credentials/azure-storage.txt`
3. 更新 `.gitignore`，添加 `credentials/` 目录
4. 更新 `azure.md`，移除真实 connection string，改为说明如何读取
5. 更新 `TOOLS.md`，指向 credentials 目录
6. 更新 `AGENTS.md`，添加 credentials/ 目录说明到工作区规范
7. 提交并推送到 GitHub

**新的文件结构:**
```
credentials/
└── azure-storage.txt    # 敏感信息，不提交到git
```

**文档更新:**
- `azure.md` 说明如何从 credentials/ 或环境变量读取
- 包含代码示例（Python 读取方法）
- 生产环境推荐使用环境变量

**Git 安全:**
- ✅ credentials/ 在 .gitignore 中
- ✅ 敏感信息不会被提交到 Git
- ✅ 文档清晰说明如何安全读取
- ✅ 符合安全最佳实践

**Commit:** `8c9dbb6` - 安全改进：分离敏感信息到credentials目录
