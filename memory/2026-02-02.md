# 2026-02-02 Daily Notes

## Maymay Backend Service Management Issue

### Problem (04:33 UTC)
- User asked to push code and restart maymay backend
- I manually started the process: `python app/main.py &`
- This created processes 41001, 41006, 41007 on port 8000
- systemd service kept trying to restart, failing with "Address already in use"

### Root Cause
Maymay backend is managed by systemd (`maymay-backend.service`). Manual process binding port 8000 prevents systemd from taking control.

### Resolution
- Killed manual process 41001
- systemd automatically restarted successfully with PIDs 41736, 41745, 41746

### Lessons Learned
1. Always use `systemctl restart maymay-backend.service` for systemd-managed services
2. Before restarting, check if there are conflicting manual processes
3. Service status command to identify issues: `systemctl status maymay-backend.service`
4. Port binding check: `ss -tlnp | grep :8000`

### Documentation Updates
- Updated MEMORY.md with "Service Management" section
- Updated AGENTS.md with critical rule in Safety section

## Code Changes

### order_service.py Refactoring
- Extracted `_adjust_stock_for_order` to eliminate duplicate stock logic
- Added `_sanitize_status` to prevent injection attacks
- Added `_validate_date` for date format validation
- Reduced `update_order_status` from ~70 lines to ~10 lines
- Commit: 6584b57 "Refactor order_service: extract stock adjustment and add input validation"
